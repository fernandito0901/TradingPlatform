# Planning Notes - P012

## Portfolio Risk Metrics

To help users evaluate strategy performance and manage risk we should track risk-adjusted returns and daily drawdown stats.

### Goals
1. Compute Sharpe ratio and max drawdown for each playbook result.
2. Display risk metrics in `reports/dashboard.html` and the web UI scoreboard.
3. Expose CLI command `risk_report` to generate risk metrics from `reports/scoreboard.csv`.
4. Support configurable risk limits per strategy.

### Risk Metric Formulas

* **Sharpe ratio** is computed on the expanding window of daily PnL as
  ``mean(pnl[:t]) / std(pnl[:t])`` using ``ddof=0``. The first day has ``std=0``
  so the ratio is reported as ``0``.
* **Max drawdown** tracks cumulative PnL relative to its running maximum. For
  each day ``t`` we calculate ``cum_pnl_t = pnl[:t].sum()`` and
  ``running_max_t = max(cum_pnl[:t])``. Drawdown is
  ``cum_pnl_t - running_max_t`` and ``max_drawdown_t`` is the minimum value
  observed so far.

### Scoreboard Schema Updates

``reports/scoreboard.csv`` must include a ``pnl`` column so risk metrics can be
computed. The ``risk_report`` CLI writes a new file ``reports/scoreboard_risk.csv``
containing ``date``, ``sharpe`` and ``max_drawdown`` columns.

### Tasks
- **T82** – @Planner specify risk metrics formulas and scoreboard schema updates.
- **T83** – @Coder implement risk metrics computation and CLI `risk_report`.
- **T84** – @Synthesizer update dashboard and web UI to display risk metrics.
- **T85** – @Reviewer document risk workflow in README.
- **T86** – @Tester add tests for `risk_report` and updated dashboard output.
