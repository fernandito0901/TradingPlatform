[tox]
envlist = smoke,smoke-reports,smoke-features,smoke-models,smoke-news,smoke-scheduler
[testenv:smoke]
skipsdist = true
allowlist_externals = bash
commands_pre =
    bash -c 'if ! command -v docker >/dev/null; then echo "SKIPPED â€“ Docker not available" && exit 0; fi'
commands = bash scripts/docker_smoke.sh --ci

[testenv:smoke-reports]
skipsdist = true
commands = python -c "import trading_platform.reports.scoreboard"

[testenv:smoke-features]
skipsdist = true
commands = python -c "import trading_platform.features"

[testenv:smoke-models]
skipsdist = true
commands = python -c "import trading_platform.models as m; assert m.train_model"

[testenv:smoke-news]
skipsdist = true
commands =
    python tasks/seed_news.py
    pytest tests/test_polygon.py

[testenv:smoke-scheduler]
skipsdist = true
commands = python - <<'PY'
    from trading_platform.scheduler import start
    from trading_platform.config import load_config
    cfg = load_config([])
    sched = start(cfg, interval=1)
    import time
    time.sleep(1)
    sched.shutdown()
    print("ok")
    PY
